trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  DB_USER: $(dbUser)        # Vari√°veis protegidas do Azure DevOps
  DB_PASSWORD: $(dbPassword)

steps:
# 1. Build Maven (pulando testes para garantir que o pipeline rode)
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'clean package -DskipTests'
  displayName: 'Build Maven Project (Skip Tests)'

# 2. Publicar artefato JAR
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: 'target/ibike.jar'
    artifactName: 'iBikeApp'
  displayName: 'Publish Build Artifact'

# 3. Build Docker e push para ACR usando seu script
- script: |
    chmod +x scripts/build.sh
    ./scripts/build.sh
  displayName: 'Build Docker Image and Push to ACR'
